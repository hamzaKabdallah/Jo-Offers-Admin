"use strict";(self.webpackChunkofersadmin=self.webpackChunkofersadmin||[]).push([[741],{8741:(yt,q,l)=>{l.r(q),l.d(q,{AuthModule:()=>At});var j=l(2757),p=l(843),t=l(4650),O=l(6535),c=l(3562),T=l(7396);let M=(()=>{class n{constructor(e){this.firestore=e}getOffers(e){const o=(0,c.hJ)(this.firestore,`offers/${e}/offers`);return(0,c.BS)((0,c.IO)(o,(0,c.ar)("validUntil",">=",new Date),(0,c.Xo)("validUntil"),(0,T.b9)(5)),{idField:"id"})}getOfferDoc(e,o){return(0,c.JU)(this.firestore,`offers/${e}/offers/${o}`)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(c.gg))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var y=l(7087),h=l(4859),u=l(3546),w=l(7392),I=l(7974),_=l(6895),P=l(5412),f=l(9549);let Q=(()=>{class n{constructor(e,o){this.data=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(P.WI),t.Y36(P.so))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-dialog"]],inputs:{description:"description"},decls:8,vars:3,consts:[["mat-dialog-title",""],["mat-button","",3,"mat-dialog-close"],["mat-button","","mat-dialog-close",""]],template:function(e,o){1&e&&(t.TgZ(0,"mat-label",0),t._uU(1),t.qZA(),t.TgZ(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"button",1),t._uU(5,"Delete"),t.qZA(),t.TgZ(6,"button",2),t._uU(7,"Close"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(o.data.title),t.xp6(2),t.hij(" ",o.data.description,"\n"),t.xp6(1),t.Q6J("mat-dialog-close","delete"))},dependencies:[h.lW,f.hX,P.ZT,P.uh],styles:["p[_ngcontent-%COMP%]{padding:15px}"]}),n})(),J=(()=>{class n{constructor(e,o,r,i){this.rout=e,this.dialog=o,this.fs=r,this.offersService=i}onDelete(){(0,c.hJ)(this.fs,"archive"),this.dialog.open(Q,{data:{title:"Be Carefull",description:"are you sure that you want to delete the offer ?"}}).afterClosed().subscribe(r=>{if(console.log(r),"delete"===r){const d=(0,c.oe)((0,c.JU)(this.fs,`offers/${this.user?.bank}/offers/${this.offer.id}`));Promise.all([d]).then(console.log)}})}onUpdate(){const e=this.offersService.getOfferDoc(this.user?.bank,this.offer.id);console.log({docRef:e}),this.rout.navigate(["auth/add-offer"],{queryParams:{offer:JSON.stringify(this.offer)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.F0),t.Y36(P.uw),t.Y36(c.gg),t.Y36(M))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-offer"]],inputs:{offer:"offer",user:"user"},decls:17,vars:3,consts:[[1,"grid-container"],[1,"grid-item"],["src","https://material.angular.io/assets/img/examples/shiba2.jpg","alt","Image",1,"image"],[1,"grid-item","grid-details-item"],[1,"text-row","title"],[1,"text-row","description"],[1,"text-row","percent"],[1,"btn-action-container"],["mat-button","",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div",0)(3,"div",1),t._UZ(4,"img",2),t.qZA(),t.TgZ(5,"div",3)(6,"div",4),t._uU(7),t.qZA(),t.TgZ(8,"div",5),t._uU(9),t.qZA(),t.TgZ(10,"div",6),t._uU(11),t.qZA()(),t.TgZ(12,"div",7)(13,"button",8),t.NdJ("click",function(){return o.onUpdate()}),t._uU(14,"update"),t.qZA(),t.TgZ(15,"button",8),t.NdJ("click",function(){return o.onDelete()}),t._uU(16,"delete"),t.qZA()()()()()),2&e&&(t.xp6(7),t.Oqu(o.offer.merchantName),t.xp6(2),t.Oqu(o.offer.description),t.xp6(2),t.Oqu(o.offer.discount))},dependencies:[h.lW,u.a8,u.dn],styles:[".grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:20% 1fr;grid-template-rows:3fr 1fr;grid-gap:10px}.text-row[_ngcontent-%COMP%]{margin-bottom:10px}.grid-item[_ngcontent-%COMP%]{display:flex;align-items:center}.image[_ngcontent-%COMP%]{width:100%;height:auto;border-radius:12px}.grid-details-item[_ngcontent-%COMP%]{flex-direction:column;align-items:start;justify-content:space-between}.grid-details-item[_ngcontent-%COMP%]   .text-row[_ngcontent-%COMP%]{margin-bottom:0}.grid-details-item[_ngcontent-%COMP%]   .text-row.title[_ngcontent-%COMP%]{color:#1f1f1f;font-size:16px;font-family:Poppins;font-weight:500}.grid-details-item[_ngcontent-%COMP%]   .text-row.description[_ngcontent-%COMP%]{color:#545454;font-size:14px;font-family:Poppins;font-weight:400}.btn-action-container[_ngcontent-%COMP%]{grid-column:2/3;display:flex;justify-content:space-evenly}"]}),n})();function z(n,a){if(1&n&&(t.TgZ(0,"mat-card",6),t._UZ(1,"app-offer",7),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Q6J("offer",e)}}const R=function(){return[5,10,15]};let V=(()=>{class n{constructor(e,o,r,i){this.router=e,this.userStoreService=o,this.offersService=r,this.loaderService=i,this.currentPage=0}ngOnInit(){this.loaderService.setLoader(!0),this.userStoreService.getUser().subscribe(e=>{e&&(this.user=e,this.offersService.getOffers(this.user.bank).subscribe(o=>{this.loaderService.setLoader(!1),this.offers=o}))})}goToAddPage(e){this.router.navigate([e])}handlePageEvent(e){console.log(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.F0),t.Y36(O.p),t.Y36(M),t.Y36(y.D))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-dashboard"]],decls:13,vars:7,consts:[[1,"container"],[1,"main-page-header"],[1,"new-offer-container"],["mat-mini-fab","","color","primary","aria-label","Example icon button with a filter list icon",3,"click"],["class","example-card",4,"ngFor","ngForOf"],[3,"length","pageSize","showFirstLastButtons","pageSizeOptions","pageIndex","page"],[1,"example-card"],[3,"offer"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title"),t._uU(3,"dashboard"),t.qZA()(),t.TgZ(4,"mat-card-content")(5,"div",2)(6,"div"),t._uU(7,"Add New Offer"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){return o.goToAddPage("auth/add-offer")}),t.TgZ(9,"mat-icon"),t._uU(10,"add"),t.qZA()()(),t.YNc(11,z,2,1,"mat-card",4),t.TgZ(12,"mat-paginator",5),t.NdJ("page",function(i){return o.handlePageEvent(i)}),t.qZA()()()),2&e&&(t.xp6(11),t.Q6J("ngForOf",o.offers),t.xp6(1),t.Q6J("length",1e3)("pageSize",20)("showFirstLastButtons",!0)("pageSizeOptions",t.DdM(6,R))("pageIndex",o.currentPage))},dependencies:[h.nh,u.a8,u.dn,u.dk,u.n5,w.Hw,I.NW,_.sg,J],styles:[".container[_ngcontent-%COMP%]{align-items:center}.container[_ngcontent-%COMP%]   .new-offer-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background-color:#e9967a;border-radius:20px;padding:4px}.container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{color:#fff;background-color:#c2185b;margin-bottom:25px;margin-top:1%;padding:0 5px}.container[_ngcontent-%COMP%]   mat-card-header.main-page-header[_ngcontent-%COMP%]{width:95%}.container[_ngcontent-%COMP%]   mat-card-header.card-header[_ngcontent-%COMP%]{border-radius:14px}.container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .header-image[_ngcontent-%COMP%]{background-size:cover;background-image:url(https://material.angular.io/assets/img/examples/shiba1.jpg)}"]}),n})();var $=l(5861),s=l(4006),b=l(751),X=l(7652),U=l(4144);let Y=(()=>{class n{constructor(e,o,r,i,d,m,g){this.fb=e,this.router=o,this.UserStoreService=r,this.firestore=i,this.route=d,this.loaderService=m,this.toolBarService=g,this.auth=(0,t.f3M)(b.gx)}ngOnDestroy(){this.subs.unsubscribe()}ngOnInit(){this.initForm(),this.subs=this.route.queryParams.subscribe(e=>{e.email&&this.form.controls.email.setValue(e.email)})}initForm(){this.form=this.fb.nonNullable.group({password:this.fb.nonNullable.control("password",[s.kI.required,s.kI.minLength(6)]),email:this.fb.nonNullable.control("hamza.air267@gmail.com",[s.kI.required,s.kI.email])})}submit(){var e=this;return(0,$.Z)(function*(){if(e.form.invalid)return;const{password:o,email:r}=e.form.value;e.loaderService.setLoader(!0);const i=yield(0,b.e5)(e.auth,r,o).finally(()=>e.loaderService.setLoader(!1));e.toolBarService.setShowToolbar(!0);const d=(0,c.JU)(e.firestore,"users",i.user.uid);try{const m=yield(0,c.QT)(d);console.log("docSnap.data()",m.data()),e.UserStoreService.setUser(m.data()||null);const g="auth/"+(m.data()?.role?"admin-dashboard":"dashboard");e.router.navigate([g])}catch(m){console.log(m),console.log("user unregister correctly")}})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(s.qu),t.Y36(p.F0),t.Y36(O.p),t.Y36(c.gg),t.Y36(p.gz),t.Y36(y.D),t.Y36(X.O))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:18,vars:2,consts:[[1,"card-container"],[3,"formGroup","ngSubmit"],["alt","Oops something wrong",3,"src"],["appearance","outline"],["type","text","matInput","","formControlName","email"],["type","password","matInput","","formControlName","password"],[1,"button"],["type","submit","mat-raised-button",""]],template:function(e,o){1&e&&(t.TgZ(0,"mat-card",0)(1,"form",1),t.NdJ("ngSubmit",function(){return o.submit()}),t._UZ(2,"img",2),t.TgZ(3,"mat-form-field",3)(4,"mat-label"),t._uU(5,"Email"),t.qZA(),t._UZ(6,"input",4),t.TgZ(7,"mat-error"),t._uU(8," Emial invalid "),t.qZA()(),t.TgZ(9,"mat-form-field",3)(10,"mat-label"),t._uU(11,"Password"),t.qZA(),t._UZ(12,"input",5),t.TgZ(13,"mat-error"),t._uU(14," Password invalid "),t.qZA()(),t.TgZ(15,"div",6)(16,"button",7),t._uU(17,"Login"),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("src","https://avatars.githubusercontent.com/u/124091983",t.LSH))},dependencies:[h.lW,U.Nt,f.KE,f.hX,f.TO,u.a8,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],styles:["[_nghost-%COMP%]{display:flex;width:100%;height:100%;align-items:center;justify-content:center}[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]{height:87%;width:45%;background-color:#fff;box-shadow:0 3px 6px #00000029;border-radius:4px;min-width:max-content}[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;width:max-content;margin:auto}[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:128px;width:128px;margin-bottom:13px}[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#c3001e;color:#fff;width:98px;height:36px;align-self:end;font:normal normal medium 14px/16px Roboto}[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-label[_ngcontent-%COMP%]{color:#c3001e}@media screen and (max-width: 920px){[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]{height:85%;width:65%}}@media screen and (max-width: 600px){[_nghost-%COMP%]   .card-container[_ngcontent-%COMP%]{height:370px;width:80%}}"]}),n})();var L=l(9635),Z=l(4004),H=l(5698);l(259);const x=(0,Z.U)(n=>!!n);let v=(()=>{class n{constructor(e,o){this.router=e,this.auth=o,this.canActivate=(r,i)=>{const d=r.data.authGuardPipe||(()=>x);return(0,b.EA)(this.auth).pipe((0,H.q)(1),d(r,i),(0,Z.U)(m=>"boolean"==typeof m?m:Array.isArray(m)?this.router.createUrlTree(m):this.router.parseUrl(m)))}}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(p.F0),t.LFG(b.gx))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function et(n,a){if(1&n&&(t.TgZ(0,"mat-card",6),t._UZ(1,"app-offer",7),t.qZA()),2&n){const e=a.$implicit,o=t.oxw();t.xp6(1),t.Q6J("offer",e)("user",o.user)}}const nt=function(){return[5,10,15]};let ot=(()=>{class n{constructor(e,o,r,i){this.router=e,this.userStoreService=o,this.offersService=r,this.firestore=i,this.currentPage=0,this.pageSize=3,this.length=0}goToAddPage(e){this.router.navigate([e])}ngOnInit(){this.userStoreService.getUser().subscribe(e=>{e&&(this.user=e,this.offers=this.offersService.getOffers(this.user.bank))})}handlePageEvent(e){console.log(e),this.currentPage=e.length;const o=(0,c.hJ)(this.firestore,`offers/${this.user?.bank}/offers`);this.offers=(0,c.BS)((0,c.IO)(o,(0,c.Xo)("merchantName"),(0,T.TQ)((e.pageIndex+1)*this.pageSize),(0,T.b9)(this.pageSize)),{idField:"id"})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.F0),t.Y36(O.p),t.Y36(M),t.Y36(c.gg))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-admin-dashboard"]],decls:20,vars:9,consts:[[1,"container"],[1,"main-page-header"],[1,"new-offer-container"],["mat-mini-fab","","color","primary","aria-label","Example icon button with a filter list icon",3,"click"],["class","example-card",4,"ngFor","ngForOf"],[3,"length","pageSize","showFirstLastButtons","pageSizeOptions","pageIndex","page"],[1,"example-card"],[3,"offer","user"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title"),t._uU(3,"dashboard"),t.qZA()(),t.TgZ(4,"mat-card-content")(5,"div",2)(6,"div"),t._uU(7,"Add New User"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){return o.goToAddPage("auth/add-user")}),t.TgZ(9,"mat-icon"),t._uU(10,"add"),t.qZA()()(),t.TgZ(11,"div",2)(12,"div"),t._uU(13,"Add New Offer"),t.qZA(),t.TgZ(14,"button",3),t.NdJ("click",function(){return o.goToAddPage("auth/add-offer")}),t.TgZ(15,"mat-icon"),t._uU(16,"add"),t.qZA()()(),t.YNc(17,et,2,2,"mat-card",4),t.ALo(18,"async"),t.TgZ(19,"mat-paginator",5),t.NdJ("page",function(i){return o.handlePageEvent(i)}),t.qZA()()()),2&e&&(t.xp6(17),t.Q6J("ngForOf",t.lcZ(18,6,o.offers)),t.xp6(2),t.Q6J("length",3)("pageSize",o.pageSize)("showFirstLastButtons",!0)("pageSizeOptions",t.DdM(8,nt))("pageIndex",o.currentPage))},dependencies:[h.nh,u.a8,u.dn,u.dk,u.n5,w.Hw,I.NW,_.sg,J,_.Ov],styles:["[_nghost-%COMP%]{border:solid orange;border-radius:24px;margin:10px 0}div.button-container[_ngcontent-%COMP%]{position:fixed;right:25px;bottom:21px}.container[_ngcontent-%COMP%]{align-items:center;width:95%;margin:auto}.container[_ngcontent-%COMP%]   .new-offer-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background-color:#e9967a;border-radius:20px;padding:4px}.container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{color:#fff;background-color:#c2185b;margin-bottom:25px;margin-top:1%;padding:0 5px}.container[_ngcontent-%COMP%]   mat-card-header.main-page-header[_ngcontent-%COMP%]{width:95%}.container[_ngcontent-%COMP%]   mat-card-header.card-header[_ngcontent-%COMP%]{border-radius:14px}.container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   .header-image[_ngcontent-%COMP%]{background-size:cover;background-image:url(https://material.angular.io/assets/img/examples/shiba1.jpg)}"]}),n})();var N=l(529),B=l(5113),E=l(3238);function rt(n,a){if(1&n&&(t.TgZ(0,"mat-option",8),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.shortName," ")}}let at=(()=>{class n{constructor(e,o,r,i,d){this.fb=e,this.http=o,this.firestore=r,this.userStoreService=i,this.auth=d,this.roles=[0,1]}ngOnInit(){this.form=this.fb.nonNullable.group({name:this.fb.nonNullable.control("",[s.kI.required]),email:this.fb.nonNullable.control("",[s.kI.required,s.kI.email]),role:this.fb.nonNullable.control(0,[s.kI.required]),bank:this.fb.nonNullable.control("",[s.kI.required]),bankName:this.fb.nonNullable.control("",[s.kI.required])}),this.setBanks(),this.changes()}changes(){this.form.controls.bank.valueChanges.subscribe(e=>{const o=this.banks.find(r=>r.id===e);this.form.controls.bankName.setValue(o?.fullName||"")})}createUser(){if(this.form.invalid)return;const e={...this.form.value};this.http.post("https://us-central1-jooffers-2a605.cloudfunctions.net/joOffersAdmin/createUser",{user:e}).subscribe(o=>{(0,b.LS)(this.auth,e.email,{url:`https://jooffers-2a605.web.app/?email=${e.email}`,handleCodeInApp:!1}).then(console.log).catch(i=>{try{console.warn(i)}catch{console.error(i)}})})}setBanks(){const e=(0,c.hJ)(this.firestore,"banks");(0,c.BS)(e,{idField:"id"}).subscribe(o=>this.banks=o)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(s.qu),t.Y36(N.eN),t.Y36(c.gg),t.Y36(O.p),t.Y36(b.gx))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-user"]],decls:30,vars:2,consts:[[3,"formGroup","submit"],["appearance","fill"],["matInput","","placeholder","Enter name","formControlName","name","required",""],["matInput","","placeholder","Enter email","formControlName","email","required",""],["formControlName","bank"],[3,"value",4,"ngFor","ngForOf"],[1,"button"],["type","submit","mat-button",""],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-card")(1,"mat-card-title"),t._uU(2,"Add New User"),t.qZA(),t.TgZ(3,"mat-card-content")(4,"form",0),t.NdJ("submit",function(){return o.createUser()}),t.TgZ(5,"p")(6,"mat-form-field",1)(7,"mat-label"),t._uU(8,"Enter user name"),t.qZA(),t._UZ(9,"input",2),t.TgZ(10,"mat-error"),t._uU(11,"enter a valid name"),t.qZA()()(),t.TgZ(12,"p")(13,"mat-form-field",1)(14,"mat-label"),t._uU(15,"Enter user email"),t.qZA(),t._UZ(16,"input",3),t.TgZ(17,"mat-error"),t._uU(18,"enter a valid Email"),t.qZA()()(),t.TgZ(19,"p")(20,"mat-form-field",1)(21,"mat-label"),t._uU(22,"Select user bank"),t.qZA(),t.TgZ(23,"mat-select",4),t.YNc(24,rt,2,2,"mat-option",5),t.qZA(),t.TgZ(25,"mat-error"),t._uU(26,"Please Selec Bank"),t.qZA()()(),t.TgZ(27,"div",6)(28,"button",7),t._uU(29,"Add"),t.qZA()()()()()),2&e&&(t.xp6(4),t.Q6J("formGroup",o.form),t.xp6(20),t.Q6J("ngForOf",o.banks))},dependencies:[h.lW,U.Nt,f.KE,f.hX,f.TO,u.a8,u.dn,u.n5,B.gD,E.ey,_.sg,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;margin:100px 0}mat-card[_ngcontent-%COMP%]{width:50%}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;justify-content:center}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:70%}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{display:block}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{padding:16px;width:300px;color:#fff;background-color:red}.button[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]}),n})();var S=l(8032),k=l(7705);var F=l(9602),D=l(6257),G=l(7494);function st(n,a){if(1&n){const e=t.EpF();t._uU(0," Drag Logo Here "),t.TgZ(1,"button",7),t.NdJ("click",function(){const i=t.CHM(e).openFileSelector;return t.KtG(i())}),t._uU(2,"Browse Files"),t.qZA()}}function lt(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"td")(2,"strong"),t._uU(3),t.qZA()()()),2&n){const e=a.$implicit;t.xp6(3),t.Oqu(e.relativePath)}}let ct=(()=>{class n{constructor(e){this.http=e,this.data=new t.vpe,this.files=[]}dropped(e){this.files=e;for(const o of e)o.fileEntry.isFile?o.fileEntry.file(i=>{console.log(o.relativePath,i),this.data.emit(i)}):console.log(o.relativePath,o.fileEntry)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(N.eN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-file-uploader"]],inputs:{formDataKey:"formDataKey"},outputs:{data:"data"},decls:11,vars:1,consts:[[1,"center"],["dropZoneLabel","Drop files here",3,"onFileDrop"],["ngx-file-drop-content-tmp",""],[1,"upload-table"],[1,"table"],[1,"upload-name-style"],[4,"ngFor","ngForOf"],["mat-button","","color","primary","type","button",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"ngx-file-drop",1),t.NdJ("onFileDrop",function(i){return o.dropped(i)}),t.YNc(2,st,3,0,"ng-template",2),t.qZA(),t.TgZ(3,"div",3)(4,"table",4)(5,"thead")(6,"tr")(7,"th"),t._uU(8,"Logo"),t.qZA()()(),t.TgZ(9,"tbody",5),t.YNc(10,lt,4,1,"tr",6),t.qZA()()()()),2&e&&(t.xp6(10),t.Q6J("ngForOf",o.files))},dependencies:[h.lW,_.sg,G.CB,G.L9]}),n})();const dt=["mapSearchField"],mt=["stepper"];function ut(n,a){1&n&&t._uU(0,"Fill out your name")}function ft(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Date is required"),t.qZA())}function pt(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Cannot select past dates or today"),t.qZA())}function gt(n,a){if(1&n&&(t.TgZ(0,"mat-option",25),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.fullName),t.xp6(1),t.hij(" ",e.shortName," ")}}function ht(n,a){if(1&n&&(t.TgZ(0,"p")(1,"mat-form-field",4)(2,"mat-label"),t._uU(3,"Select Offer bank"),t.qZA(),t.TgZ(4,"mat-select",24),t.YNc(5,gt,2,2,"mat-option",16),t.ALo(6,"async"),t.qZA(),t.TgZ(7,"mat-error"),t._uU(8,"Please Selec Bank"),t.qZA()()()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",t.lcZ(6,1,e.banks))}}function _t(n,a){if(1&n&&(t.TgZ(0,"mat-option",25),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function Ct(n,a){if(1&n&&t._UZ(0,"map-marker",26),2&n){const e=a.$implicit,o=t.oxw();t.Q6J("position",e)("options",o.markerOptions)}}function bt(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1,"Please Selec Place From The Map"),t.qZA())}function Ot(n,a){1&n&&t._uU(0,"Add logo")}function vt(n){return n.value<new Date?{pastDate:!0}:null}const A=()=>("login",(0,L.z)(x,(0,Z.U)(a=>a||"login"))),Mt=[{path:"login",component:Y,data:{authGuardPipe:()=>("dashboard",(0,L.z)(x,(0,Z.U)(a=>!a||"dashboard")))}},{path:"dashboard",component:V,canActivate:[v],data:{authGuardPipe:A}},{path:"admin-dashboard",component:ot,canActivate:[v],data:{authGuardPipe:A}},{path:"add-user",component:at,canActivate:[v],data:{authGuardPipe:A}},{path:"add-offer",component:(()=>{class n{constructor(e,o,r,i,d,m,g,C){this.formBuilder=e,this.userStoerService=o,this.http=r,this.firestore=i,this.storage=d,this.activatedRoute=m,this.loaderService=g,this.offersSerivce=C,this.startDate=new Date,this.categories=[],this.initialCoordinates={lat:31.973563151821196,lng:35.879144795504025},this.mapConfigurations={disableDefaultUI:!1,fullscreenControl:!0,zoomControl:!0},this.markerOptions={draggable:!1},this.markerPositions=[],this.isupdateMode=!1}ngOnInit(){this.setCategories(),this.setUpdateOfferDetails(),this.newForm(),this.setUser(),this.setBanks(),this.changesListeners()}setCategories(){this.http.get("assets/categories.json").subscribe(e=>this.categories=e)}setBanks(){const e=(0,c.hJ)(this.firestore,"banks");this.banks=(0,c.BS)((0,c.IO)(e,(0,c.Xo)("shortName")),{idField:"id"})}changesListeners(){}setUser(){this.userStoerService.getUser().subscribe(e=>{this.user=e,this.form.controls.bankName.setValue(e?.bankName||"")})}newForm(){let e;if(this.isupdateMode){const{category:o,coordinates:i,validUntil:d,discount:m,description:g,merchantName:C,arMerchantName:Tt}=this.offerDetail;e={category:o,description:g,discount:m,merchantName:C,arMerchantName:Tt,latitude:i?.latitude||this.initialCoordinates.lat,longitude:i?.longitude||this.initialCoordinates.lng,validUntil:d}}else e={category:this.categories[1],description:"",discount:"",merchantName:"",arMerchantName:"",latitude:this.initialCoordinates.lat,longitude:this.initialCoordinates.lng,validUntil:""};this.form=this.formBuilder.nonNullable.group({category:this.formBuilder.nonNullable.control(e.category,[s.kI.required]),description:this.formBuilder.nonNullable.control(e.description,[s.kI.required]),arDescription:this.formBuilder.nonNullable.control(e.description),discount:this.formBuilder.nonNullable.control(e.discount,[s.kI.required,s.kI.min(1),s.kI.max(100)]),merchantName:this.formBuilder.nonNullable.control(e.merchantName,[s.kI.required]),arMerchantName:this.formBuilder.nonNullable.control(e.merchantName),latitude:this.formBuilder.nonNullable.control(e.latitude,[s.kI.required]),longitude:this.formBuilder.nonNullable.control(e.longitude,[s.kI.required]),validUntil:this.formBuilder.nonNullable.control(e.validUntil,[s.kI.required,vt]),bankName:this.formBuilder.nonNullable.control(this.user?.bankName||"")})}submit(e){if(console.log(this.form.value),this.markerPositions.length)if(this.loaderService.setLoader(!0),this.isupdateMode){const o=this.offersSerivce.getOfferDoc(this.user?.bank,this.offerDetail?.id);(0,c.r7)(o,this.getParams()).then(r=>{this.loaderService.setLoader(!1),this.stepper.next(),console.log({v:r})}).catch(r=>{this.loaderService.setLoader(!1),console.error(r)})}else this.http.post("https://us-central1-jooffers-2a605.cloudfunctions.net/joOffersAdmin/addOffers",this.getParams()).subscribe(o=>{this.loaderService.setLoader(!1),this.stepper.next(),console.log({response:o})},o=>{this.loaderService.setLoader(!1),console.error(o)});else this.setSelectPlaceValidity(!0)}ngAfterViewInit(){const e=new google.maps.places.SearchBox(this.serchField.nativeElement);this.map.controls[google.maps.ControlPosition.TOP_CENTER].push(this.serchField.nativeElement),e.addListener("places_changed",()=>{const o=e.getPlaces();if(0===o?.length)return;const r=new google.maps.LatLngBounds;o?.forEach(i=>{i.geometry?.location&&(i.geometry.viewport?r.union(i.geometry.viewport):r.extend(i.geometry.location))}),this.map.fitBounds(r)})}getParams(){const{latitude:e,longitude:o,merchantName:r,discount:i,arMerchantName:d,description:m,arDescription:g}=this.form.value,C={...this.form.value,location:{latitude:e,longitude:o},merchantName:r?.toLowerCase(),arMerchantName:d||r,displayName:r,discount:i+"%",bankId:this.user?.bank,description:m,arDescription:g};return delete C.longitude,delete C.latitude,{offer:{bankID:this.user?.bank,offers:[C]}}}onMapClick(e){if(!e.latLng)return;const o=e.latLng.lat(),r=e.latLng.lng();this.initialCoordinates={lat:o,lng:r},this.markerPositions.pop(),this.markerPositions.push(e.latLng.toJSON()),this.form.controls.latitude.setValue(o),this.form.controls.latitude.setValue(r),this.setSelectPlaceValidity(!1)}setSelectPlaceValidity(e){this.form.setErrors({isSelectPlace:e})}onLogochanged(e){const r=(0,S.iH)(this.storage,`logos/${e.name}`);(0,S.B0)(r,e)}setUpdateOfferDetails(){this.isupdateMode=this.activatedRoute.snapshot.queryParams.offer,this.offerDetail=this.isupdateMode?JSON.parse(this.activatedRoute.snapshot.queryParamMap.get("offer")):null}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(s.qu),t.Y36(O.p),t.Y36(N.eN),t.Y36(c.gg),t.Y36(S.Ke),t.Y36(p.gz),t.Y36(y.D),t.Y36(M))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-offer"]],viewQuery:function(e,o){if(1&e&&(t.Gf(dt,5),t.Gf(k.b6,5),t.Gf(mt,5)),2&e){let r;t.iGM(r=t.CRH())&&(o.serchField=r.first),t.iGM(r=t.CRH())&&(o.map=r.first),t.iGM(r=t.CRH())&&(o.stepper=r.first)}},decls:64,vars:15,consts:[[3,"linear","animationDuration"],["stepper",""],[3,"formGroup","submit"],["matStepLabel",""],["appearance","fill"],["matInput","","placeholder","Enter merchantName","formControlName","merchantName"],["matInput","","placeholder","Enter description","formControlName","description","required",""],["appearance","fill",1,"discount"],["matInput","","placeholder","Enter discount","formControlName","discount"],["margin","","matSuffix",""],["matInput","","formControlName","validUntil",3,"matDatepicker"],["matIconSuffix","",3,"for"],["startView","year",3,"startAt"],["picker",""],[4,"ngIf"],["formControlName","category"],[3,"value",4,"ngFor","ngForOf"],["type","text",1,"my-map-search-field"],["mapSearchField",""],["width","100%",3,"center","options","mapClick"],[3,"position","options",4,"ngFor","ngForOf"],[1,"button"],["type","submit","mat-button",""],["formDataKey","logo",3,"data"],["formControlName","bankName"],[3,"value"],[3,"position","options"]],template:function(e,o){if(1&e){const r=t.EpF();t.TgZ(0,"mat-card")(1,"mat-card-title"),t._uU(2,"Add New Offer"),t.qZA(),t.TgZ(3,"mat-card-content")(4,"mat-stepper",0,1)(6,"mat-step")(7,"form",2),t.NdJ("submit",function(){t.CHM(r);const d=t.MAs(5);return t.KtG(o.submit(d))}),t.YNc(8,ut,1,0,"ng-template",3),t.TgZ(9,"p")(10,"mat-form-field",4)(11,"mat-label"),t._uU(12,"Enter Offer merchantName"),t.qZA(),t._UZ(13,"input",5),t.TgZ(14,"mat-error"),t._uU(15,"enter a valid merchantName"),t.qZA()()(),t.TgZ(16,"p")(17,"mat-form-field",4)(18,"mat-label"),t._uU(19,"Enter Offer description"),t.qZA(),t._UZ(20,"input",6),t.TgZ(21,"mat-error"),t._uU(22,"enter a valid description"),t.qZA()()(),t.TgZ(23,"p")(24,"mat-form-field",7)(25,"mat-label"),t._uU(26,"Enter Offer discount"),t.qZA(),t._UZ(27,"input",8),t.TgZ(28,"span",9),t._uU(29,"%"),t.qZA(),t.TgZ(30,"mat-error"),t._uU(31,"enter a valid discount"),t.qZA()()(),t.TgZ(32,"p")(33,"mat-form-field",4)(34,"mat-label"),t._uU(35,"Choose a date"),t.qZA(),t._UZ(36,"input",10),t.TgZ(37,"mat-hint"),t._uU(38,"MM/DD/YYYY"),t.qZA(),t._UZ(39,"mat-datepicker-toggle",11)(40,"mat-datepicker",12,13),t.YNc(42,ft,2,0,"mat-error",14),t.YNc(43,pt,2,0,"mat-error",14),t.qZA()(),t.YNc(44,ht,9,3,"p",14),t.TgZ(45,"p")(46,"mat-form-field",4)(47,"mat-label"),t._uU(48,"Select Offer Category"),t.qZA(),t.TgZ(49,"mat-select",15),t.YNc(50,_t,2,2,"mat-option",16),t.qZA(),t.TgZ(51,"mat-error"),t._uU(52,"Please Selec Category"),t.qZA()()(),t._UZ(53,"input",17,18),t.TgZ(55,"google-map",19),t.NdJ("mapClick",function(d){return o.onMapClick(d)}),t.YNc(56,Ct,1,2,"map-marker",20),t.qZA(),t.YNc(57,bt,2,0,"mat-error",14),t.TgZ(58,"div",21)(59,"button",22),t._uU(60),t.qZA()()()(),t.TgZ(61,"mat-step"),t.YNc(62,Ot,1,0,"ng-template",3),t.TgZ(63,"app-file-uploader",23),t.NdJ("data",function(d){return o.onLogochanged(d)}),t.qZA()()()()()}if(2&e){const r=t.MAs(41);t.xp6(4),t.Q6J("linear",!0)("animationDuration","500"),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(29),t.Q6J("matDatepicker",r),t.xp6(3),t.Q6J("for",r),t.xp6(1),t.Q6J("startAt",o.startDate),t.xp6(2),t.Q6J("ngIf",o.form.controls.validUntil.hasError("required")),t.xp6(1),t.Q6J("ngIf",o.form.controls.validUntil.hasError("pastDate")),t.xp6(1),t.Q6J("ngIf",1===(null==o.user?null:o.user.role)),t.xp6(6),t.Q6J("ngForOf",o.categories),t.xp6(5),t.Q6J("center",o.initialCoordinates)("options",o.mapConfigurations),t.xp6(1),t.Q6J("ngForOf",o.markerPositions),t.xp6(1),t.Q6J("ngIf",o.form.hasError("isSelectPlace")),t.xp6(3),t.Oqu(o.isupdateMode?"Update":"Add Offer")}},dependencies:[h.lW,U.Nt,f.KE,f.hX,f.bx,f.TO,f.R9,u.a8,u.dn,u.n5,B.gD,E.ey,F.Mq,F.hl,F.nW,D.C0,D.VY,D.Vq,_.sg,_.O5,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,k.b6,k.O_,ct,_.Ov],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;margin:100px 0}mat-card[_ngcontent-%COMP%]{width:50%}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;justify-content:center}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:70%}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{display:block}mat-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%], mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{padding:16px;width:300px;color:#fff;background-color:red}.button[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]}),n})(),canActivate:[v],data:{authGuardPipe:A}},{path:"**",component:Y}];let Zt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(Mt),p.Bz]}),n})(),At=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[Zt,j.m]}),n})()}}]);